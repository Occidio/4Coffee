<!doctype html>
<html>
<head>
	<title></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
	<script type="text/javascript">
		function init()
		{
			GetGraph(dayOfWeekAsInteger(new Date().getDay()));
			UpdateDateTime();
			UpdateApproxTimeValue();
		}

		function dayOfWeekAsInteger(day) {
			var dayArray = ["Sunday","0","1","2","3","4","Saturday"]
		  	return dayArray[day];
		}

		function UpdateApproxTimeValue(){
			document.getElementById("ApproxTimeValue").innerHTML = document.getElementById("ApproxTime").value;
		}

		function UpdateDateTime(){
			var d = new Date();
			d.setMilliseconds(000);
			document.getElementById("Time").value = d.toISOString().replace('Z', '');
		}

		function GetGraph(day)
		{
		    var xmlHttp = new XMLHttpRequest();
		    xmlHttp.open( "GET", "http://localhost:3000/GetGraph?Day=" + day, false ); // false for synchronous request
		    xmlHttp.send( );
			
			var arRayception = JSON.parse(xmlHttp.responseText);
			var data = {
	            labels: ["0800", "0815", "0830", "0845", "0900", "0915", "0930", "0945", "1000", "1015", "1030", "1045", "1100", "1115", "1130", "1145", "1200", "1215", "1230", "1245","1300", "1315", "1330", "1345","1400", "1415", "1430", "1445","1500", "1515", "1530", "1545","1600"],
	            datasets: [
	                {
	                    label: "Averages",
	                    fillColor: "rgba(220,220,220,0.2)",
	                    strokeColor: "rgba(220,220,220,1)",
	                    pointColor: "rgba(220,220,220,1)",
	                    pointStrokeColor: "#fff",
	                    pointHighlightFill: "#fff",
	                    pointHighlightStroke: "rgba(220,220,220,1)",
	                    data: arRayception[0]
	                },
	                {
	                    label: "Today",
	                    fillColor: "rgba(151,187,205,0.2)",
	                    strokeColor: "rgba(151,187,205,1)",
	                    pointColor: "rgba(151,187,205,1)",
	                    pointStrokeColor: "#fff",
	                    pointHighlightFill: "#fff",
	                    pointHighlightStroke: "rgba(220,220,220,1)",
	                    data: arRayception[1]
	                }
	            ]
	        };

	        var ctx = document.getElementById("myChart").getContext("2d");
	        var myNewChart = new Chart(ctx).Line(data);
		}
	</script>
</head>
<body onload="init()">
<h1 style="text-align: center;">4Coffee queue</h1>

<table border="0" cellpadding="0" cellspacing="0" style="border:1px solid #ccc; padding:5px 10px; width:100%; height:80%; position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);">
	<tbody>
		<tr>
			<td width="60%">
				<h3><u>Queue times</u></h3>
				<div><input type="button" value="Monday" onclick="GetGraph(0)"/><input type="button" value="Tuesday" onclick="GetGraph(1)"/><input type="button" value="Wednesday" onclick="GetGraph(2)"/><input type="button" value="Thursday" onclick="GetGraph(3)"/><input type="button" value="Friday" onclick="GetGraph(4)"/></div>
				&nbsp;
			    <canvas id="myChart" style="width:90%; height:60%;"></canvas>
			<td>&nbsp;</td>
			<td width="40%">
				<u>Submit a queue length</u>
				&nbsp;
				<form action="http://localhost:3000/Log" method="post">
				<p>Date/time:&nbsp;<input type="datetime-local" id="Time" name="Time" required/><input type="button" value="Now" onclick="UpdateDateTime()"/></p>

				<p>Approximate queue duration:&nbsp;<input type="range" id="ApproxTime" name="ApproxTime" max="15" min="0" value="5" oninput="UpdateApproxTimeValue()" required/><div id="ApproxTimeValue"></div> minutes</p>

				<p>Coffee machine working?:&nbsp;<input type="checkbox" name="CoffeeMachine" checked required/></p>

				<p>Card machine working?:&nbsp;<input type="checkbox" name="CardMachine" checked required/></p>

				<p><input type="submit" value="Submit entry" /></p>
				</form>
			</td>
		</tr>
	</tbody>
</table>

</body>
</html>